###############################################################################
###############################################################################
####                                                                       ####
####              THIS FILE WAS GENERATED WITH METASTRUCTURE               ####
####                       DO NOT EDIT IT MANUALLY!                        ####
####                                                                       ####
###############################################################################
###############################################################################

###############################################################################
# Default provider.
###############################################################################
provider "aws" {
  default_tags {
    tags = {
      Generator = "Terraform"
    }
  }
  region  = module.global.config.organization.aws_region
}

###############################################################################
# Create a provider to assume the {{#if params.assume_role}}{{params.assume_role}}{{else}}{{lodash "get" accounts (params terraform.state.account "permission_set_roles" params.permission_set)}}{{/if}} 
# role on the Terraform state account.
###############################################################################
provider "aws" {
  alias   = "terraform_state_account"{{#if (logic "or" params.permission_set (logic "and" params.assume_role (logic "not" (lodash "eq" terraform.state.account organization.master_account))))}}
  assume_role { 
    role_arn = "arn:aws:iam::{{lodash "get" accounts (params terraform.state.account "id")}}:role/{{#if params.assume_role}}{{params.assume_role}}{{else}}{{lodash "get" accounts (params terraform.state.account "permission_set_roles" params.permission_set)}}{{/if}}"
    {{#if params.permission_set}}tags = {
      Generator = "Terraform"
    }
    transitive_tag_keys = ["Generator"]
  {{/if}} }{{/if}}
  default_tags {
    tags = {
      Generator = "Terraform"
    }
  }
  region = module.global.config.organization.aws_region
}
{{#each accounts}}
###############################################################################
# Create a provider {{#if (logic "or" ../params.permission_set (logic "and" ../params.assume_role (logic "not" (lodash "eq" @key ../organization.master_account))))}}to assume the {{#if ../params.assume_role}}{{../params.assume_role}}{{else}}{{lodash "get" this (params "permission_set_roles" ../params.permission_set)}}{{/if}} 
# role {{/if}}on account {{this.name}}.
###############################################################################
provider "aws" { 
  alias   = "{{@key}}"{{#if (logic "or" ../params.permission_set (logic "and" ../params.assume_role (logic "not" (lodash "eq" @key ../organization.master_account))))}}
  assume_role { 
    role_arn = "arn:aws:iam::{{this.id}}:role/{{#if ../params.assume_role}}{{../params.assume_role}}{{else}}{{lodash "get" this (params "permission_set_roles" ../params.permission_set)}}{{/if}}"
    {{#if ../params.permission_set}}tags = {
      Generator = "Terraform"
    }
    transitive_tag_keys = ["Generator"]
  {{/if}} }{{/if}}
  default_tags {
    tags = {
      Generator = "Terraform"
    }
  }
  region = module.global.config.organization.aws_region
}

{{/each}}